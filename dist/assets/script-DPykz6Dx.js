import{initializeApp as P}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";import{getAnalytics as F}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";import{getFirestore as x,collection as d,getDocs as p,doc as b,setDoc as L,addDoc as S,query as B,where as D}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";import{getAuth as C,GoogleAuthProvider as U,onAuthStateChanged as I,signOut as $,signInWithPopup as O}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const R={apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,measurementId:void 0},y=P(R);F(y);const c=x(y),f=C(y),A=new U,i=(t,e="info")=>{const s={success:"linear-gradient(to right, #00b09b, #96c93d)",error:"linear-gradient(to right, #ff5f6d, #ffc371)",warning:"linear-gradient(to right, #f093fb, #f5576c)",info:"linear-gradient(to right, #4facfe, #00f2fe)"};Toastify({text:t,duration:1500,gravity:"top",position:"center",stopOnFocus:!0,style:{background:s[e]||s.info}}).showToast()};let a=null;I(f,t=>{a=t;const e=document.getElementById("userProfile"),s=document.getElementById("profileImage"),r=document.getElementById("userEmail"),o=document.getElementById("authBtn"),n=document.getElementById("authBtnText");t?(console.log("User signed in:",t.email),N(),s&&(s.src=t.photoURL||"https://via.placeholder.com/40?text=User"),r&&(r.textContent=t.displayName||"User"),e&&(e.classList.remove("d-none"),e.classList.add("d-flex")),n&&(n.textContent="Sign out"),o&&(o.onclick=()=>{$(f).then(()=>{console.log("Signed out successfully"),i("Signed out successfully","success")}).catch(l=>{console.error("Sign out error:",l),i("Sign out failed: "+l.message,"error")})})):(console.log("User signed out"),e&&(e.classList.remove("d-flex"),e.classList.add("d-none")),n&&(n.textContent="Sign in"),o&&(o.onclick=E))});const T=()=>{var o;const e=new URLSearchParams(window.location.search).get("folder"),s=(o=document.getElementById("noteTextarea"))==null?void 0:o.value;if(!a){i("Please sign in first","warning");return}if(!s){i("Please write something first","warning");return}if(!e){i("No folder selected","error");return}const r=b(c,`users/${a.uid}/notes`,e);L(r,{folderName:e,content:s,updatedAt:new Date},{merge:!0}).then(()=>{console.log("Note saved for folder:",e),i("Note saved successfully! ðŸ“","success")}).catch(n=>{console.error("Error saving note:",n),i("Failed to save note: "+n.message,"error")})};window.save=T;const E=()=>{O(f,A).then(t=>{const e=t.user;console.log("Successfully signed in as:",e.email),i(`Welcome, ${e.displayName||e.email}! ðŸ‘‹`,"success")}).catch(t=>{console.error("Sign-in error:",t.code,t.message),i("Sign-in failed: "+t.message,"error")})};window.signIn=E;let u=document.getElementById("folderName"),g=document.getElementById("noteName"),m=document.getElementById("display");const h=[],N=async()=>{if(!(!a||!m))try{const t=d(c,`users/${a.uid}/folders`),e=await p(t);h.length=0,m.innerHTML="";const s=[];e.forEach(r=>{const o=r.data();s.push({id:r.id,name:o.name}),h.push(o.name)}),s.forEach(r=>{m.innerHTML+=`     
            <div class="p-5 bg-info" style="width: 15%; height: 17vh; overflow: hidden;">
                <a href="/public/note.html?folder=${encodeURIComponent(r.name)}" class="bg-white px-3 text-center form-control" style="word-break: break-all; max-height: 4vh; overflow-y: auto;">
                    ${r.name}
                </a>
            </div>
            `}),console.log(`Loaded ${h.length} folders from database`)}catch(t){console.error("Error loading folders:",t)}},M=()=>{if(!a){i("Please sign in before creating folders","warning");return}if(u.value===""){i("Please enter a folder name","warning");return}const t=u.value;console.log("Attempting to create folder:",t),console.log("Current user ID:",a.uid),console.log("Database path:",`users/${a.uid}/folders`),S(d(c,`users/${a.uid}/folders`),{name:t,createdAt:new Date,userId:a.uid}).then(e=>{console.log("âœ… Folder saved successfully with ID:",e.id),i(`Folder "${t}" created! ðŸ“`,"success"),N(),u.value=""}).catch(e=>{console.error("âŒ ERROR creating folder:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),e.code==="permission-denied"?i("Permission denied! Please enable Firestore in Firebase Console","error"):e.code==="unavailable"?i("Firestore not available. Please enable it in Firebase Console","error"):i("Failed to create folder: "+e.message,"error")})};window.createFolder=M;if(g){const e=new URLSearchParams(window.location.search).get("folder");if(e){g.textContent=e,console.log("Opened folder:",e);const s=async()=>{if(!a){console.log("Waiting for user to sign in...");return}try{const r=b(c,`users/${a.uid}/notes`,e),o=await p(B(d(c,`users/${a.uid}/notes`),D("folderName","==",e))),n=await p(d(c,`users/${a.uid}/notes`));let l=null;n.forEach(v=>{v.id===e&&(l=v.data())});const w=document.getElementById("noteTextarea");l&&w?(w.value=l.content||"",console.log("Loaded note content for:",e)):console.log("No existing note found for this folder")}catch(r){console.error("Error loading note:",r)}};a?s():I(f,r=>{r&&s()})}else g.textContent="Untitled Folder"}
